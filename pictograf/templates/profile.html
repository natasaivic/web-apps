<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="utf-8">
    <meta name="author" content="Natasa Ivic">
    <meta name="description" content="This page is a user&apos;s personal profile.">

    <title>Profile</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="/static/style.css" rel="stylesheet">
    <link rel="icon" href="/static/images/favicon.ico" type="image/x-icon">

    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
</head>

<body>
    {% include 'flash_messages.html' %}

    <nav>
        <a href="/feed">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-camera2" viewBox="0 0 16 16">
                    <path d="M5 8c0-1.657 2.343-3 4-3V4a4 4 0 0 0-4 4z"></path>
                    <path d="M12.318 3h2.015C15.253 3 16 3.746 16 4.667v6.666c0 .92-.746 1.667-1.667 1.667h-2.015A5.97 5.97 0 0 1 9 14a5.972 5.972 0 0 1-3.318-1H1.667C.747 13 0 12.254 0 11.333V4.667C0 3.747.746 3 1.667 3H2a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1h.682A5.97 5.97 0 0 1 9 2c1.227 0 2.367.368 3.318 1zM2 4.5a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0zM14 8A5 5 0 1 0 4 8a5 5 0 0 0 10 0z"></path>
                    </svg> </a> |
        <a href="/profile"> <img src="/static/profile-pics/{{session['profile_pic'] if session['profile_pic'] else 'no-picture.jpg'}}" class="rounded-circle nav-pic"> </a> | <a href="/logout">Logout</a>
    </nav>

    <hr>
    <div class="container">
        <div class="row">
            <div class="col"></div>

            <div class="col">
                {% if posts|count == 0 %} No posts to show. To make a new post <a href="/post">click here</a> {% else %}
                <a href="/post">Create new post</a>
                <hr>
                <ul>
                    {% for post in posts %}
                    <li>
                        <div><i class="create_on">{{post[3]}}</i></div>
                        <img class="post" src="/static/files/{{post[1]}}">
                        <br> {{post[2]}} | <b id="likes-of-{{post[0]}}"> {{post_likes[post[0]]}} </b> likes | <a href="javascript:;" onclick="addLike({{post[0]}})">+1</a>
                        <br> {% if post_comments[post[0]]|count == 0 %}
                        <form action="/comment/{{post[0]}}" method="POST">
                            <textarea type="text" rows="2" cols="40" name="comment" placeholder="Comment" class="textarea"></textarea>
                            <button type="submit" name="comment" class="w-100 btn btn-lg btn-primary">Submit Comment</button>
                        </form>
                        {% else %}
                        <ul id="comments-of-{{post[0]}}">
                            {% for comment in post_comments[post[0]] %}
                            <li>
                                <a href="/profile"><img class="rounded-circle nav-pic" src="/static/profile-pics/{{comment[1]}}.jpg"></a> {{comment[3]}} | {{comment[2]}} | <a href="/delete/{{comment[0]}}" onclick="return confirm('Are you sure?')">delete comment</a>
                            </li>
                            {% endfor %}
                        </ul>
                        
                        <textarea id="comment-for-{{post[0]}}" type="text" rows="2" cols="40" name="comment" placeholder="Comment" class="textarea"></textarea>
                        <button id="submit-for-{{post[0]}}" type="submit" name="comment" class="w-100 btn btn-lg btn-primary">Submit Comment</button>
                        <script>
                            $("#submit-for-{{post[0]}}").on('click', function() {
                                var comment = $("#comment-for-{{post[0]}}").val();
                                var post_id = {{post[0]}};

                                $.ajax({
                                    method: 'POST',
                                    url: "/comment_ajax/" + post_id,
                                    data: {comment: comment},
                                    success: function (result) {
                                        $("#comments-of-" + post_id).html(result);
                                    },
                                    error: function () {
                                        alert("Comment not successful, try again");
                                    }
                                });
                            });
                        </script>
                        {% endif %}
                        <hr>
                    </li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>

            <div class="col">
                <a href="/edit_profile_pic" title="Click to change profile picture"><img src="/static/profile-pics/{{session['profile_pic'] if session['profile_pic'] else 'no-picture.jpg'}}" class="rounded-circle profile-pic"></a>
                <br> {{session['name']}} {{session['surname']}}
                <br>
                <a href="/settings">Settings</a>
                <br>
                <a href="/edit_profile">Edit profile</a>
                <br> üìç <a href="https://en.wikipedia.org/wiki/{{info[0]}}" target="_blank">{{info[0]}} </a>
                <br> üè° <a href="https://en.wikipedia.org/wiki/{{info[1]}}" target="_blank"> {{info[1]}} </a>
                <br> üìù {{info[2]}}
            </div>
        </div>
    </div>
    <script>
    
    function addLike(post_id) {
        $.ajax({
            method: 'POST',
            url: "/addlike/" + post_id,
            success: function (result) {
                var old_val = parseInt($("#likes-of-" + post_id).html());
                $("#likes-of-" + post_id).html(old_val + 1);
            }
        });
    }

    </script>
</body>

</html>